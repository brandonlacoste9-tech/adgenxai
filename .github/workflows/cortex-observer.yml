name: Cortex Observer
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch: {}
permissions:
  contents: read
  issues: write
jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - run: curl -sSL https://adgenxai.pro/.netlify/functions/webhook-telemetry > t.json && curl -sSL https://adgenxai.pro/.netlify/functions/health > h.json
      - uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const t = JSON.parse(fs.readFileSync('t.json'));
            const h = JSON.parse(fs.readFileSync('h.json'));
            const b = '## ðŸ§  Cortex\n**Time:** ' + new Date().toISOString() + '\n### Health\n``````\n### Telemetry\n``````';
            const r = await github.rest.issues.listForRepo({owner:context.repo.owner,repo:context.repo.repo,labels:'cortex-status',state:'open',per_page:1});
            if(r.data.length) await github.rest.issues.createComment({owner:context.repo.owner,repo:context.repo.repo,issue_number:r.data[0].number,body:b});
