name: Cortex Observer
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch: {}
permissions:
  contents: read
  issues: write
jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch data
        run: |
          curl -sSL https://adgenxai.pro/.netlify/functions/webhook-telemetry > t.json
          curl -sSL https://adgenxai.pro/.netlify/functions/health > h.json
      - name: Post comment
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const t = JSON.parse(fs.readFileSync('t.json', 'utf8'));
            const h = JSON.parse(fs.readFileSync('h.json', 'utf8'));
            const body = `## ðŸ§  Cortex Status\n**Time:** ${new Date().toISOString()}\n### Health\n\`\`\`json\n${JSON.stringify(h,null,2)}\n\`\`\`\n### Telemetry\n\`\`\`json\n${JSON.stringify(t,null,2)}\n\`\`\``;
            const {data:i} = await github.rest.issues.listForRepo({owner:context.repo.owner,repo:context.repo.repo,labels:'cortex-status',state:'open',per_page:1});
            if(i.length) await github.rest.issues.createComment({owner:context.repo.owner,repo:context.repo.repo,issue_number:i[0].number,body});
